<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>RRPD Receiving Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <link rel="stylesheet" href="style.css" />
  <link rel="icon" href="favicon.ico" />

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

  <!-- SheetJS (XLSX export with multiple tabs) -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
</head>

<body>
  <header class="app-bar">
    <div class="app-left">
      <img src="detroit-axle-logo.png" alt="DA Logo" class="logo" />
      <div class="app-titles">
        <h1>RRPD Receiving Dashboard</h1>
        <span id="status_text" class="status">Ready</span>
      </div>
    </div>

    <div class="app-actions">
      <button id="export_all_btn" class="btn primary">Export All (XLSX)</button>
    </div>
  </header>

  <nav class="tabs">
    <button class="tab-btn active" data-target="tab-csv">CSV Dashboard</button>
    <button class="tab-btn" data-target="tab-manual">Manual Counts</button>
    <button class="tab-btn" data-target="tab-carriers">Carriers</button>
    <button class="tab-btn" data-target="tab-loose">Loose Parts</button>
  </nav>

  <main class="page">

    <!-- ================= CSV DASHBOARD ================= -->
    <section id="tab-csv" class="tab active">

      <div class="grid two">
        <article class="panel">
          <h2>CSV Import</h2>
          <p class="panel-sub">
            Upload WH Returns CSV. Multiplier-safe:
            <span class="mono">600153760440x2</span> or <span class="mono">2x600153760440</span>.
            It will NOT treat <span class="mono">x2020</span> as 2020 parts.
          </p>

          <div class="form-row">
            <input id="csv_file" type="file" accept=".csv" />
            <button id="csv_export_btn" class="btn small">Export CSV Summary (CSV)</button>
            <button id="csv_clear_btn" class="btn small danger">Clear</button>
          </div>

          <div class="kpis">
            <div class="kpi"><span class="kpi-label">Counted rows</span><span id="kpi_counted" class="kpi-val">0</span></div>
            <div class="kpi"><span class="kpi-label">Skipped rows</span><span id="kpi_skipped" class="kpi-val">0</span></div>
            <div class="kpi"><span class="kpi-label">Trackings</span><span id="kpi_trackings" class="kpi-val">0</span></div>
            <div class="kpi"><span class="kpi-label">Total parts</span><span id="kpi_parts" class="kpi-val">0</span></div>
          </div>

          <p class="panel-sub note">
            Skips only: <b>Return Label</b>, and the safety case where <b>Part Number == Track Number</b>.
            Includes: Good / Used / Core / Missing / Not Our Part / Other…
          </p>
        </article>

        <article class="panel">
          <h2>Validation / Skips</h2>
          <p class="panel-sub">Audit-friendly proof of what was skipped and why.</p>
          <div class="table-scroll">
            <table id="table_validation" class="data-table">
              <thead><tr><th>Reason</th><th>Count</th></tr></thead>
              <tbody></tbody>
            </table>
          </div>
          <p class="panel-sub note" id="csv_run_note"></p>
        </article>
      </div>

      <!-- ===== FedEx tracking list check (NEW) ===== -->
      <div class="grid two">
        <article class="panel">
          <h2>FedEx Tracking List Check</h2>
          <p class="panel-sub">
            Upload the FedEx downloadable list (CSV or TXT). This checks whether every FedEx tracking number exists
            in the WH CSV tracking list (and shows anything missing/extra).
          </p>

          <div class="form-row">
            <input id="fedex_file" type="file" accept=".csv,.txt" />
            <button id="fedex_clear_btn" class="btn small danger">Clear FedEx Check</button>
          </div>

          <div class="kpis">
            <div class="kpi"><span class="kpi-label">FedEx found</span><span id="kpi_fedex_total" class="kpi-val">0</span></div>
            <div class="kpi"><span class="kpi-label">Matched</span><span id="kpi_fedex_matched" class="kpi-val">0</span></div>
            <div class="kpi"><span class="kpi-label">Missing in WH</span><span id="kpi_fedex_missing_in_wh" class="kpi-val">0</span></div>
            <div class="kpi"><span class="kpi-label">Missing in FedEx</span><span id="kpi_wh_missing_in_fedex" class="kpi-val">0</span></div>
          </div>
        </article>

        <article class="panel">
          <h2>FedEx Differences</h2>
          <p class="panel-sub">Shows the numbers so you can copy/paste and verify.</p>
          <div class="table-scroll tall">
            <table id="table_fedex_diff" class="data-table">
              <thead><tr><th>Type</th><th>Tracking Number</th></tr></thead>
              <tbody></tbody>
            </table>
          </div>
        </article>
      </div>

      <!-- ===== Return Conditions ONLY ===== -->
      <div class="grid two">
        <article class="panel">
          <h2>Return Conditions Mix</h2>
          <p class="panel-sub">Pie chart by PN Description (multiplier-aware)</p>
          <canvas id="chart_desc_pie"></canvas>
        </article>

        <article class="panel">
          <h2>Return Conditions Totals</h2>
          <p class="panel-sub">Bar chart by PN Description (multiplier-aware)</p>
          <canvas id="chart_desc_bar"></canvas>
        </article>
      </div>

      <div class="grid two">
        <article class="panel">
          <h2>Totals by Description</h2>
          <div class="table-scroll">
            <table id="table_desc" class="data-table">
              <thead><tr><th>Description</th><th>Parts</th><th>Rows</th></tr></thead>
              <tbody></tbody>
            </table>
          </div>
        </article>

        <article class="panel">
          <h2>Notes</h2>
          <p class="panel-sub">Tracking totals are separated below.</p>
          <p class="panel-sub note" id="csv_hint"></p>
        </article>
      </div>

      <!-- ===== Tracking + Part Count ONLY ===== -->
      <div class="grid two">
        <article class="panel">
          <h2>Tracking Numbers + Total Parts</h2>
          <p class="panel-sub">Sorted by most parts first (multiplier-aware)</p>
          <div class="table-scroll tall">
            <table id="table_tracking" class="data-table">
              <thead><tr><th>Track Number</th><th>Total Parts</th></tr></thead>
              <tbody></tbody>
            </table>
          </div>
        </article>

        <article class="panel">
          <h2>Tracking Breakdown (by Description)</h2>
          <p class="panel-sub">
            Showing top <b>250</b> lines to keep the page short (export includes everything).
          </p>
          <div class="table-scroll tall">
            <table id="table_breakdown" class="data-table">
              <thead><tr><th>Track Number</th><th>Description</th><th>Parts</th><th>Rows</th></tr></thead>
              <tbody></tbody>
            </table>
          </div>
        </article>
      </div>

    </section>

    <!-- ================= MANUAL COUNTS ================= -->
    <section id="tab-manual" class="tab">
      <div class="grid two">
        <article class="panel">
          <h2>Manual Entry</h2>
          <p class="panel-sub">Enter counts for racks/axles/drive shafts/gear boxes. Saves locally.</p>

          <div class="form-row">
            <input id="manual_dt" type="datetime-local" />
            <button id="manual_now" class="btn small">Set = now</button>
            <button id="manual_save" class="btn small primary">Save</button>
            <button id="manual_clear" class="btn small danger">Clear</button>
          </div>

          <div class="table-scroll">
            <table class="data-table">
              <thead><tr><th>Item</th><th>Count</th></tr></thead>
              <tbody>
                <tr><td>Good Racks</td><td><input id="m_good_racks" class="mini-input" type="number" min="0" value="0"></td></tr>
                <tr><td>Core Racks</td><td><input id="m_core_racks" class="mini-input" type="number" min="0" value="0"></td></tr>
                <tr><td>Good Electric Racks</td><td><input id="m_good_eracks" class="mini-input" type="number" min="0" value="0"></td></tr>
                <tr><td>Core Electric Racks</td><td><input id="m_core_eracks" class="mini-input" type="number" min="0" value="0"></td></tr>

                <tr><td>Good Axles</td><td><input id="m_good_axles" class="mini-input" type="number" min="0" value="0"></td></tr>
                <tr><td>Used Axles</td><td><input id="m_used_axles" class="mini-input" type="number" min="0" value="0"></td></tr>

                <tr><td>Good Drive Shafts</td><td><input id="m_good_ds" class="mini-input" type="number" min="0" value="0"></td></tr>
                <tr><td>Used Drive Shafts</td><td><input id="m_used_ds" class="mini-input" type="number" min="0" value="0"></td></tr>

                <tr><td>Good Gear boxes</td><td><input id="m_good_gb" class="mini-input" type="number" min="0" value="0"></td></tr>
                <tr><td>Used Gear boxes</td><td><input id="m_used_gb" class="mini-input" type="number" min="0" value="0"></td></tr>
              </tbody>
            </table>
          </div>

          <p class="panel-sub note" id="manual_saved_note"></p>
        </article>

        <article class="panel">
          <h2>Totals + Ratios</h2>
          <p class="panel-sub">Ratios show both ratio and percentage.</p>
          <div class="table-scroll">
            <table id="table_manual_summary" class="data-table">
              <thead><tr><th>Metric</th><th>Value</th></tr></thead>
              <tbody></tbody>
            </table>
          </div>
        </article>
      </div>

      <div class="grid two">
        <article class="panel">
          <h2>Totals by Category</h2>
          <p class="panel-sub">Bar: Total racks/axles/drive shafts/gear boxes</p>
          <canvas id="chart_manual_totals"></canvas>
        </article>

        <article class="panel">
          <h2>Condition Mix</h2>
          <p class="panel-sub">Pie: Good vs Used vs Core (manual)</p>
          <canvas id="chart_manual_pie"></canvas>
        </article>
      </div>

      <article class="panel">
        <h2>Split by Category</h2>
        <p class="panel-sub">Bar: Good/Used/Core split by category</p>
        <canvas id="chart_manual_split"></canvas>
      </article>
    </section>

    <!-- ================= CARRIERS ================= -->
    <section id="tab-carriers" class="tab">
      <div class="grid two">
        <article class="panel">
          <h2>Carrier Log</h2>
          <p class="panel-sub">Log received qty, received time, completed time. Mark complete with checkbox or button.</p>

          <div class="form-row">
            <input id="carrier_name" type="text" placeholder="Carrier (UPS, FedEx, etc.)" />
            <input id="carrier_qty" type="number" min="0" placeholder="Received qty" />
            <input id="carrier_received" type="datetime-local" />
            <button id="carrier_received_now" class="btn small">Received = now</button>
            <input id="carrier_completed" type="datetime-local" />
            <button id="carrier_completed_now" class="btn small">Completed = now</button>
            <button id="carrier_add" class="btn small primary">Add</button>
          </div>

          <div class="form-row">
            <button id="carrier_export" class="btn small">Export (XLSX)</button>
            <button id="carrier_clear" class="btn small danger">Clear</button>
          </div>

          <div class="table-scroll tall">
            <table id="table_carriers" class="data-table">
              <thead>
                <tr>
                  <th>Done</th>
                  <th>Carrier</th>
                  <th>Qty</th>
                  <th>Received</th>
                  <th>Completed</th>
                  <th>Status</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </article>

        <article class="panel">
          <h2>Carrier Volume</h2>
          <p class="panel-sub">Bar: total received qty per carrier</p>
          <canvas id="chart_carriers"></canvas>
        </article>
      </div>
    </section>

    <!-- ================= LOOSE PARTS ================= -->
    <section id="tab-loose" class="tab">
      <div class="grid two">
        <article class="panel">
          <h2>Loose Parts</h2>
          <p class="panel-sub">
            No graph. Enter part number (typed if label damaged) and condition.
            Multipliers like <span class="mono">x2</span> / <span class="mono">2x</span> work here too.
          </p>

          <div class="form-row">
            <input id="loose_part" type="text" placeholder="Part Number" />
            <select id="loose_cond">
              <option value="Good">Good</option>
              <option value="Used">Used</option>
              <option value="Core">Core</option>
              <option value="Missing">Missing</option>
              <option value="Not Our Part">Not Our Part</option>
              <option value="Other">Other</option>
            </select>
            <input id="loose_dt" type="datetime-local" />
            <button id="loose_now" class="btn small">Set = now</button>
            <button id="loose_add" class="btn small primary">Add</button>
          </div>

          <div class="form-row">
            <button id="loose_export" class="btn small">Export (XLSX)</button>
            <button id="loose_clear" class="btn small danger">Clear</button>
          </div>

          <div class="kpis">
            <div class="kpi"><span class="kpi-label">Loose total qty</span><span id="loose_total" class="kpi-val">0</span></div>
          </div>
        </article>

        <article class="panel">
          <h2>Loose Parts Log</h2>
          <div class="table-scroll tall">
            <table id="table_loose" class="data-table">
              <thead><tr><th>Part</th><th>Condition</th><th>Qty</th><th>Date</th><th>Actions</th></tr></thead>
              <tbody></tbody>
            </table>
          </div>
        </article>
      </div>
    </section>

  </main>

  <footer class="footer">
    <span>RRPD • Detroit Axle</span>
    <span id="updated_small"></span>
  </footer>

  <script src="script.js"></script>
</body>
</html>
